"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.cancelToken=exports.create=void 0;const request_1=require("./request"),router_1=require("./router");exports.create=(e=>{const t={socket:e,onError:console.error,onRouteError:(e,t)=>{console.error(e),t.status=500,t.send()},call:request_1.call.bind(null,e),get:request_1.get.bind(null,e,"GET"),post:request_1.post.bind(null,e,"POST"),patch:request_1.patch.bind(null,e,"PATCH"),put:request_1.put.bind(null,e,"PUT"),delete:request_1.del.bind(null,e,"DELETE"),on:router_1.on,onGet:router_1.onGet,onPost:router_1.onPost};return(void 0!==e.on?e.on.bind(e):e.addEventListener.bind(e))("message",async r=>{try{const o=JSON.parse("string"==typeof r?r:r.data);0===o.t?await router_1.routeRequest(t,e,o):request_1.commitResponses(o)}catch(e){t.onError(e)}}),t}),exports.cancelToken=(()=>{const e={builder:async t=>await new Promise((r,o)=>{e.reject=(e=>{clearTimeout(t),o(e)})})};return e});
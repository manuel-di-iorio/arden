"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.routeRequest=exports.onDelete=exports.onPut=exports.onPatch=exports.onPost=exports.onGet=exports.on=void 0;const routes=[];exports.on=((e,t,o,n)=>{"function"==typeof o&&(n=o,o=[]);const s=[];routes.push({method:e,url:t,params:s,regex:t instanceof RegExp?t:new RegExp(t.replace(/(:[a-z0-9_$]+)/gi,e=>(s.push(e.slice(1)),"(.+)"))),handlers:o.concat(n)})}),exports.onGet=exports.on.bind(null,"GET"),exports.onPost=exports.on.bind(null,"POST"),exports.onPatch=exports.on.bind(null,"PATCH"),exports.onPut=exports.on.bind(null,"PUT"),exports.onDelete=exports.on.bind(null,"DELETE"),exports.routeRequest=(async(e,t,{i:o,m:n,u:s,d:r})=>{for(const u of routes){if(u.method!==n)continue;const i=u.regex.exec(s);if(null===i)continue;const p={};let c=200;const l=i.slice(1).reduce((e,t,o)=>({...e,[u.params[o]]:t}),{}),x=s.indexOf("?"),a=-1!==x?new URLSearchParams(s.slice(x+1)):null,d={socket:t,locals:p,url:s,params:l,query:a,body:r,sent:!1,get status(){return c},set status(e){c=e},send:e=>{d.sent=!0,t.send(JSON.stringify({t:1,i:o,u:s,m:n,s:c,d:e}))}};try{for(const e of u.handlers){const t=await e(d);if("object"==typeof t||"number"==typeof t||"string"==typeof t)return void d.send(t);if(d.sent)return}return void(d.sent||d.send())}catch(t){return void e.onRouteError(t,d)}}t.send(JSON.stringify({t:1,i:o,u:s,m:n,s:404}))});